# 如何高效地获得玩家排名？



这种题目一般很难答，因为具体得看需求，但是暂且抛开需求，我想了一种做法，并没有实践过。
由于排名是动态变化的，因此玩家不需要记录当前是第几名，玩家身上只保存有积分即可。然后可以构建一个以积分为下标的int数组，这个数组多长就看你积分最多会有多少了。（少说1000万也够用了吧？也就4G的内存，这个按具体的需求，如果每周清一次积分？）数组元素表示当前以此下标为积分数对应的玩家数，即：当前有多少个玩家拥有这么多积分。我们把这个数组叫作rank，rank[100]的值就是当前积分为100的玩家的数量。
这个数组在服务器启动的时候根据玩家数重建一份置于内存中（或者共享内存，对于启动速度有要求的话），后续的操作都是增量式操作这个数组，具体的步骤是：当A与B打架完后，取出两者老的排名，在对应的数组元素中减去1，再往新的排名下标元素加上1。这样，它的排序复杂度是O(1)，但是取玩家排名的时候就蛋疼了，因为我要从头到当前的位置扫一遍，把前面数量加一下才可以知道当前是第几名，针对这种情况我觉得可以优化一下，把数组元素扩展多一个变量(above_num)，保存前面的排名数量，这样当A跟B打架的时候，只需要把A跟B之间变化的above_num更新一下即可（一般来讲A跟B变化的区间总不会很大吧）。



如果你一定要立刻获得排名的话，你可以贡献一台服务器不断的做排序，一旦有分数update就立刻排序，这样延迟最多也就几秒钟。你战斗结束之后放个动画，就有准确排名了。